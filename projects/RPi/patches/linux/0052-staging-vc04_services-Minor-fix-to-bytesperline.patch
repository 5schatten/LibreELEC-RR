From 9929b5920800627964efd660be114ffd682bc7a0 Mon Sep 17 00:00:00 2001
From: Dave Stevenson <dave.stevenson@raspberrypi.org>
Date: Fri, 9 Mar 2018 18:01:06 +0000
Subject: [PATCH 52/80] staging: vc04_services: Minor fix to bytesperline

Signed-off-by: Dave Stevenson <dave.stevenson@raspberrypi.org>
---
 .../staging/vc04_services/bcm2835-codec/bcm2835-v4l2-codec.c | 5 +++--
 1 file changed, 3 insertions(+), 2 deletions(-)

diff --git a/drivers/staging/vc04_services/bcm2835-codec/bcm2835-v4l2-codec.c b/drivers/staging/vc04_services/bcm2835-codec/bcm2835-v4l2-codec.c
index c4d1101fee7f..a5cf3247cf6f 100644
--- a/drivers/staging/vc04_services/bcm2835-codec/bcm2835-v4l2-codec.c
+++ b/drivers/staging/vc04_services/bcm2835-codec/bcm2835-v4l2-codec.c
@@ -736,14 +736,15 @@ static int vidioc_s_fmt(struct bcm2835_codec_ctx *ctx, struct v4l2_format *f)
 	q_data->height	= f->fmt.pix.height;
 
 	if (!q_data->fmt->flags & V4L2_FMT_FLAG_COMPRESSED) {
-		f->fmt.pix.bytesperline =
+		q_data->bytesperline =
 				ALIGN((f->fmt.pix.width * q_data->fmt->depth) >> 3,
 				      q_data->fmt->bytesperline_align);
 		q_data->sizeimage = f->fmt.pix.sizeimage;
 	} else {
-		f->fmt.pix.bytesperline = 0;
+		q_data->bytesperline = 0;
 		q_data->sizeimage = DEFAULT_COMPRESSED_BUF_SIZE;
 	}
+	f->fmt.pix.bytesperline = q_data->bytesperline;
 
 	setup_mmal_port_format(q_data, port);
 	ret = vchiq_mmal_port_set_format(ctx->dev->instance, port);
-- 
2.17.0

