From 53db50fe7c9ed7643121857ab3027cab9c7e9663 Mon Sep 17 00:00:00 2001
From: Dave Stevenson <dave.stevenson@raspberrypi.org>
Date: Wed, 28 Feb 2018 14:46:42 +0000
Subject: [PATCH 47/80] dt: add overlay for V4L2 codec driver

Signed-off-by: Dave Stevenson <dave.stevenson@raspberrypi.org>
---
 arch/arm/boot/dts/overlays/Makefile           |  1 +
 .../dts/overlays/bcm2835-codec-overlay.dts    | 22 +++++++++++++++++++
 arch/arm/configs/bcm2709_defconfig            |  1 +
 3 files changed, 24 insertions(+)
 create mode 100644 arch/arm/boot/dts/overlays/bcm2835-codec-overlay.dts

diff --git a/arch/arm/boot/dts/overlays/Makefile b/arch/arm/boot/dts/overlays/Makefile
index 87427214329a..2b3bc7275bf8 100644
--- a/arch/arm/boot/dts/overlays/Makefile
+++ b/arch/arm/boot/dts/overlays/Makefile
@@ -19,6 +19,7 @@ dtbo-$(CONFIG_ARCH_BCM2835) += \
 	audremap.dtbo \
 	balena-fin.dtbo \
 	bcm2835-v4l2.dtbo \
+	bcm2835-codec.dtbo \
 	bmp085_i2c-sensor.dtbo \
 	dht11.dtbo \
 	dionaudio-loco.dtbo \
diff --git a/arch/arm/boot/dts/overlays/bcm2835-codec-overlay.dts b/arch/arm/boot/dts/overlays/bcm2835-codec-overlay.dts
new file mode 100644
index 000000000000..59ec0dbbc043
--- /dev/null
+++ b/arch/arm/boot/dts/overlays/bcm2835-codec-overlay.dts
@@ -0,0 +1,22 @@
+/*
+ * Device tree overlay for V4L2 codec overlay
+ *
+ */
+
+/dts-v1/;
+/plugin/;
+
+/{
+	compatible = "brcm,bcm2708";
+
+	fragment@0 {
+		target = <&soc>;
+		__overlay__ {
+			v4l2: v4l2 {
+				compatible = "raspberrypi,bcm2835-v4l2-encoder";
+				status = "okay";
+			};
+		};
+	};
+
+};
diff --git a/arch/arm/configs/bcm2709_defconfig b/arch/arm/configs/bcm2709_defconfig
index f579d1b90f31..f3dc798095c3 100644
--- a/arch/arm/configs/bcm2709_defconfig
+++ b/arch/arm/configs/bcm2709_defconfig
@@ -1201,6 +1201,7 @@ CONFIG_BCM2835_VCHIQ=y
 CONFIG_BCM2835_VCHIQ_SUPPORT_MEMDUMP=y
 CONFIG_SND_BCM2835=m
 CONFIG_VIDEO_BCM2835=m
+CONFIG_VIDEO_DECODE_BCM2835=m
 CONFIG_BCM_VC_SM_CMA=y
 CONFIG_MAILBOX=y
 CONFIG_BCM2835_MBOX=y
-- 
2.17.0

